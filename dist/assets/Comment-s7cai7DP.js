import{_ as L,u as A,b as O,i as $,r as _,f as Q,j as E,o as i,c,a as s,C as x,D as M,E as N,F as R,p as S,q as W,x as v,k as X,G as V,m as u,H as q,l as K}from"./index-78te5h-u.js";const Y={style:{"letter-spacing":"1px"}},Z={class:"head"},ee=["src"],se={key:1,src:V,alt:""},te=["onKeyup"],oe={class:"content"},ne={href:"javascript:;",class:"first-img"},ae=["src"],le={key:1,src:V,alt:""},ie={class:"first-content"},ce={class:"first-username"},re={class:"first-time"},de={class:"first-comment"},ue=["onMouseleave","onMouseover"],pe=["onClick"],_e=["onClick"],ve=["onClick"],he={key:0},me={key:0,class:"reply-comment"},fe=["onKeyup"],ge=["onClick"],ye={class:"second"},ke={class:"top"},Ce={href:"JavaScript:;",class:"second-img"},$e=["src"],we={key:1,src:V},be={class:"second-content"},xe={class:"second-username"},Me={class:"second-time"},Ne={class:"second-comment"},Ke={class:"second-reply"},Ve={class:"to_reply"},Be={class:"to_reply"},Ue=["onMouseleave","onMouseover"],je=["onClick"],Ie=["onClick"],Te=["onClick"],De={key:0},Fe={key:0,class:"reply-comment reply_li"},Pe=["onKeyup"],Ee=["onClick"],Re={key:0,style:{"text-align":"center","margin-top":"15px"}},Se={__name:"Comment",props:{userid:Number,articleid:Number,self:Boolean},setup(z){A(),O(),$("serverUrl");const f=$("axios"),g=$("message"),G=$("dialog"),h=_({}),y=_(""),w=_(""),n=_([]),m=_(""),b=_(!0),B=_(!1),U=_(0),d=z;console.log("props.userid:"+d.userid),console.log("props.articleid:"+d.articleid),Q(()=>{k()});const k=async()=>{let t=await f.get("user/briefInfo/"+d.userid);console.log(t),t.code==200&&(h.value=t.data,y.value=h.value.avatar,h.value.userid==h.value.loginid&&(self.value=!0));let l=await f.get("comment/"+d.articleid);if(console.log(l),l.code==200)if(n.value=l.data,n.value.length){b.value=!1,B.value=!0,U.value=n.value.length;for(let e=0;e<n.value.length;e++){this.$set(n[e],"display",!1),d.self?this.$set(n[e],"delete",!1):n[e].userid===d.userid&&this.$set(n[e],"delete",!1),this.$set(n[e],"flag",!0),n[e].flag?(console.log(n[e].flag),this.$set(n[e],"like","component-like")):this.$set(n[e],"like","");for(let r=0;r<n[e].child.length;r++)this.$set(n[e].child[r],"display",!1),d.self?this.$set(n[e].child[r],"delete",!1):n[e].child[r].userid===d.userid&&this.$set(n[e].child[r],"delete",!1),this.$set(n[e].child[r],"flag",!1),n[e].child[r].flag?this.$set(n[e].child[r],"like","component-like"):this.$set(n[e].child[r],"like","")}}else this.page>1?(this.page--,this.view_comments()):(b.value=!0,showPage.value=!1)},j=async()=>{const t={content:w.value,userid:d.userid,username:h.value.username,avatar:y.value,articleid:d.articleid};console.log(t);let l=await f.post("/comment",t);console.log(l),l.code==200&&(g.warning("评论成功",{showIcon:!1}),n.value="",k())},C=async(t,l)=>{const e={content:m.value,userid:d.userid,username:h.value.username,avatar:y.value,articleid:d.articleid,parentid:t.id,tousername:""};l==1&&(e.tousername=t.username,e.parentid=t.parentid),console.log(e);let r=await f.post("/comment",e);console.log(r),r.code==200&&(g.warning("评论成功",{showIcon:!1}),t.display=!1,m.value="",k())},I=async t=>{t.delete=!1},T=async t=>{t.delete=!0},D=async t=>{t.display=!0},F=async t=>{t.flag=!0,g.info("点赞成功")},P=async(t,l)=>{G.warning({title:"警告",content:"是否要删除",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{let e=await f.remove("comment",t);e.code==200?(g.info(e.message),k()):g.error(e.message)},onNegativeClick:()=>{}})};return(t,l)=>{const e=E("n-empty"),r=E("n-pagination");return i(),c("div",Y,[s("div",Z,[y.value?(i(),c("img",{key:0,src:y.value,alt:""},null,8,ee)):(i(),c("img",se)),x(s("input",{type:"text",placeholder:"请输入评论 . . .",ref:"input",onFocus:l[0]||(l[0]=(...a)=>t.obtain&&t.obtain(...a)),onBlur:l[1]||(l[1]=(...a)=>t.lose&&t.lose(...a)),"onUpdate:modelValue":l[2]||(l[2]=a=>w.value=a),onKeyup:N(j,["enter"])},null,40,te),[[M,w.value]]),s("button",{onClick:j},"发表评论")]),s("div",oe,[(i(!0),c(R,null,S(n.value,(a,H)=>(i(),c("div",{class:"first",key:H},[s("a",ne,[a.avatar?(i(),c("img",{key:0,src:a.avatar,alt:""},null,8,ae)):(i(),c("img",le))]),s("div",ie,[s("h3",ce,u(a.username),1),s("span",re,u(a.createtime),1),s("p",de,u(a.content),1),s("div",{class:"first-right",onMouseleave:o=>I(a),onMouseover:o=>T(a)},[a.delete?(i(),c("span",{key:0,class:"delete",onClick:o=>P(a)},"删除",8,pe)):v("",!0),s("span",{class:"comments",onClick:o=>D(a)},"评论",8,_e),s("span",{class:q(["praise",a.like]),onClick:o=>F(a)},[a.likestar?(i(),c("span",he,u(a.likestar),1)):v("",!0)],10,ve)],40,ue),a.display?(i(),c("div",me,[x(s("input",{type:"text",placeholder:"请输入评论 . . .","onUpdate:modelValue":l[3]||(l[3]=o=>m.value=o),onKeyup:N(o=>C(a,0),["enter"])},null,40,fe),[[M,m.value]]),s("button",{onClick:o=>C(a,0)},"发表评论",8,ge)])):v("",!0),s("div",ye,[s("ul",null,[(i(!0),c(R,null,S(a.child,(o,J)=>(i(),c("li",{key:J},[s("div",ke,[s("a",Ce,[o.avatar?(i(),c("img",{key:0,src:o.avatar},null,8,$e)):(i(),c("img",we))]),s("div",be,[s("h3",xe,u(o.username),1),s("span",Me,u(o.createtime),1),s("p",Ne,[s("span",Ke,[s("span",Ve,u(o.username),1),K(" 回复 "),s("span",Be,u(o.tousername),1),K("： ")]),K(" "+u(o.content),1)]),s("div",{class:"second-right",onMouseleave:p=>I(o),onMouseover:p=>T(o)},[o.delete?(i(),c("span",{key:0,class:"delete",onClick:p=>P(o)},"删除",8,je)):v("",!0),s("span",{class:"comments",onClick:p=>D(o)},"评论",8,Ie),s("span",{class:q(["praise",o.like]),onClick:p=>F(o)},[o.numbers?(i(),c("span",De,u(o.numbers),1)):v("",!0)],10,Te)],40,Ue)])]),o.display?(i(),c("div",Fe,[x(s("input",{type:"text",placeholder:"请输入评论 . . .","onUpdate:modelValue":l[4]||(l[4]=p=>m.value=p),onKeyup:N(p=>C(o,1),["enter"])},null,40,Pe),[[M,m.value]]),s("button",{onClick:p=>C(o,1)},"发表评论",8,Ee)])):v("",!0)]))),128))])])])]))),128)),b.value?(i(),W(e,{key:0,description:"暂无评论"})):v("",!0)]),B.value.value?(i(),c("div",Re,[X(r,{background:"",layout:"prev, pager, next",total:U.value*10,onCurrentChange:t.currentPage,"current-page":t.page},null,8,["total","onCurrentChange","current-page"])])):v("",!0)])}}},ze=L(Se,[["__scopeId","data-v-73c76dd9"]]);export{ze as default};
