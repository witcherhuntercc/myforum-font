import{R as K,S as L,_ as P}from"./RichTextEditor-LAujlH9F.js";import{_ as Q,u as W,b as X,i as b,r as m,e as N,f as Y,j as n,o as g,c as w,a as l,k as t,w as s,F as Z,n as f,l as v,q as ee,x as te,s as oe,v as ae}from"./index-78te5h-u.js";import{A as se,C as ne}from"./Close-c0HtZweH.js";const le=u=>(oe("data-v-696cc1b9"),u=u(),ae(),u),ce={class:"topbar"},re=le(()=>l("text",{style:{position:"absolute",left:"200px","line-height":"50px",color:"#383838"}},"标题",-1)),de={style:{position:"absolute",right:"50px",top:"8px"}},ie={class:"tabs"},ue={style:{width:"400px",height:"450px",background:"white"}},pe={key:0,style:{width:"300px",height:"150px",margin:"0 auto"}},_e={style:{"margin-bottom":"12px"}},me={key:1,style:{width:"230px",margin:"0 auto"}},ge={style:{width:"300px",margin:"0 auto"}},fe={style:{position:"absolute",right:"100px",bottom:"30px"}},ve={style:{position:"absolute",right:"30px",bottom:"30px"}},he={__name:"Update",setup(u){const B=W(),k=X();b("serverUrl");const d=b("axios"),h=b("message"),I=m(!1),y=N({avatarUrl:"",id:0}),U=m([]),o=N({id:0,categoryName:"education",title:"",content:"",headImage:""}),p=m(!1),_=m(!1);Y(()=>{V(),q(),F()});const V=async()=>{let e=await d.get("/user");console.log(e),e.code==200&&(y.avatarUrl=e.data.avatar,y.id=e.data.userid)},q=async()=>{let e=await d.get("/category");console.log(e.data),U.value=e.data.map(a=>({label:a.name,value:a.name}))},F=async()=>{let e=await d.get("/article/"+k.query.id);console.log(e),e.code==200&&(o.categoryName=e.data.category,o.title=e.data.title,o.content=e.data.content,o.headImage=e.data.avatar,_.value=!!o.headImage,I.value=!0)},S=()=>{p.value=!0},A=()=>{p.value=!1},M=async e=>{var a;return((a=e.file.file)==null?void 0:a.type)!=="image/png"?(h.error("只能上传png格式的图片"),!1):!0},R=async({file:e})=>{const a=new FormData;a.append("file",e.file),a.append("type","avatar");let c=await d.post("/upload",a);console.log(c),o.headImage=c.data,_.value=!0},z=()=>{o.headImage="",_.value=!1},D=async()=>{let e=await d.put("/article/"+k.query.id,{category:o.categoryName,title:o.title,content:o.content,avatar:o.headImage});console.log(e),e.code==200?(h.success(e.message),C()):h.error(e.message)},C=()=>{B.go(-2)};return(e,a)=>{const c=n("n-icon"),i=n("n-button"),E=n("n-input"),j=n("n-avatar"),x=n("n-card"),O=n("n-text"),H=n("n-upload-dragger"),T=n("n-upload"),$=n("n-image"),G=n("n-select"),J=n("n-modal");return g(),w(Z,null,[l("div",ce,[t(i,{onClick:C,strong:"",quaternary:"",round:"",style:{position:"absolute",left:"50px",top:"7px","font-size":"24px"},color:"#7B3DE0"},{default:s(()=>[t(c,null,{default:s(()=>[t(f(K))]),_:1})]),_:1}),re,t(E,{value:o.title,"onUpdate:value":a[0]||(a[0]=r=>o.title=r),round:"",placeholder:"请输入标题",style:{position:"absolute",left:"265px",top:"8px",width:"1000px","background-color":"#F3F0F9"}},null,8,["value"]),t(j,{round:"",size:"medium",src:y.avatarUrl,style:{position:"absolute",right:"190px",top:"8px"}},null,8,["src"]),l("div",de,[t(i,{round:"",color:"#7B3DE0",onClick:S},{icon:s(()=>[t(c,null,{default:s(()=>[t(f(L))]),_:1})]),default:s(()=>[v(" 发布 ")]),_:1})])]),l("div",ie,[t(x,null,{default:s(()=>[I.value?(g(),ee(P,{key:0,modelValue:o.content,"onUpdate:modelValue":a[1]||(a[1]=r=>o.content=r)},null,8,["modelValue"])):te("",!0)]),_:1})]),t(J,{show:p.value,"onUpdate:show":a[3]||(a[3]=r=>p.value=r)},{default:s(()=>[l("div",ue,[t(x,{title:"封面",bordered:!1},{default:s(()=>[_.value?(g(),w("div",me,[t($,{height:"150",width:"300",src:o.headImage},null,8,["src"]),t(i,{onClick:z,circle:"",style:{position:"absolute",left:"298px",top:"50px"},color:"#383838"},{icon:s(()=>[t(c,null,{default:s(()=>[t(f(ne))]),_:1})]),_:1})])):(g(),w("div",pe,[t(T,{multiple:"","directory-dnd":"",max:1,onBeforeUpload:M,"custom-request":R},{default:s(()=>[t(H,null,{default:s(()=>[l("div",_e,[t(c,{size:"48",depth:3},{default:s(()=>[t(f(se))]),_:1})]),t(O,{style:{"font-size":"16px"}},{default:s(()=>[v(" 点击或者拖动图片到此处 ")]),_:1})]),_:1})]),_:1})]))]),_:1}),t(x,{title:"分类",bordered:!1},{default:s(()=>[l("div",ge,[t(G,{value:o.categoryName,"onUpdate:value":a[2]||(a[2]=r=>o.categoryName=r),options:U.value,placeholder:"请选择分类"},null,8,["value","options"])])]),_:1}),l("div",fe,[t(i,{type:"default",onClick:A},{default:s(()=>[v(" 取消 ")]),_:1})]),l("div",ve,[t(i,{type:"primary",onClick:D},{default:s(()=>[v(" 确认 ")]),_:1})])])]),_:1},8,["show"])],64)}}},we=Q(he,[["__scopeId","data-v-696cc1b9"]]);export{we as default};
